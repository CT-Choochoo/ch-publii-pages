<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>RabbitMQ_简介 - As One Wants</title><meta name="description" content="1. RabbitMQ简介&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><meta name="theme-color" content="#17181E" media="(prefers-color-scheme: dark)"><meta name="theme-color" content="#2A2C33" media="(prefers-color-scheme: light)"><meta name="msapplication-navbutton-color" content="#2A2C33"><meta name="apple-mobile-web-app-status-bar-style" content="#2A2C33"><script async defer="defer" type="text/javascript" src="" data-website-id="74fc0332-4948-4dfe-9825-7ef3229acbce" data-auto-track="true" data-do-not-track="true" data-cache="false"></script><link rel="canonical" href="https://ct-choochoo.github.io/ch-publii-pages/rabbitmq-yichu-bu-ren-shi/"><link rel="alternate" type="application/atom+xml" href="https://ct-choochoo.github.io/ch-publii-pages/feed.xml"><link rel="alternate" type="application/json" href="https://ct-choochoo.github.io/ch-publii-pages/feed.json"><meta property="og:title" content="RabbitMQ_简介 - As One Wants "><meta property="og:site_name" content="As One Wants"><meta property="og:description" content="1. RabbitMQ简介&hellip;"><meta property="og:url" content="https://ct-choochoo.github.io/ch-publii-pages/rabbitmq-yichu-bu-ren-shi/"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://ct-choochoo.github.io/ch-publii-pages/media/website/Calm.svg" type="image/x-icon"><link rel="preload" href="https://ct-choochoo.github.io/ch-publii-pages/assets/dynamic/fonts/jetbrainsmono/jetbrainsmono.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="https://ct-choochoo.github.io/ch-publii-pages/assets/dynamic/fonts/redhatmono/redhatmono.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://ct-choochoo.github.io/ch-publii-pages/assets/css/style.css?v=855e32e981f98461e83a3606ba6b5549"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://ct-choochoo.github.io/ch-publii-pages/rabbitmq-yichu-bu-ren-shi/"},"headline":"RabbitMQ_简介","datePublished":"2023-03-11T18:08","dateModified":"2023-03-14T09:54","description":"1. RabbitMQ简介&hellip;","author":{"@type":"Person","name":"铁柱","url":"https://ct-choochoo.github.io/ch-publii-pages/authors/tiezhu/"},"publisher":{"@type":"Organization","name":"铁柱"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript><script async defer="defer" src="https://analytics.umami.is/script.js" data-website-id="74fc0332-4948-4dfe-9825-7ef3229acbce"></script><link rel="stylesheet" href="https://ct-choochoo.github.io/ch-publii-pages/media/plugins/docSearch/docsearch.min.css"></head><body><div class="container js-container"><nav class="menu"><ul class="navbar__menu"><li><a href="https://ct-choochoo.github.io/ch-publii-pages/" target="_self">home</a></li><li><a href="https://ct-choochoo.github.io/ch-publii-pages/tags/" target="_self">标签</a></li><li class="has-submenu"><span>工作</span><ul class="navbar__submenu"><li class="has-submenu"><span>语言</span><ul class="navbar__submenu"><li><a href="https://ct-choochoo.github.io/ch-publii-pages/tags/biao-qian/" target="_self">java</a></li><li><a href="https://ct-choochoo.github.io/ch-publii-pages/tags/python/" target="_self">python</a></li></ul></li><li class="has-submenu"><span>框架</span><ul class="navbar__submenu"><li><a href="https://ct-choochoo.github.io/ch-publii-pages/tags/springboot/" target="_self">springboot</a></li></ul></li><li><a href="https://ct-choochoo.github.io/ch-publii-pages/tags/common/" target="_self">工具</a></li></ul></li><li class="has-submenu"><a href="https://ct-choochoo.github.io/ch-publii-pages/tags/sheng-huo/" target="_self">生活</a><ul class="navbar__submenu"><li><a href="https://ct-choochoo.github.io/ch-publii-pages/tags/lu-you/" target="_self">游记</a></li></ul></li></ul></nav><div class="content"><header class="top"><div class="top__item"><a class="logo" href="https://ct-choochoo.github.io/ch-publii-pages/">As One Wants</a></div><div class="top__item top__item--right"><button class="menu-toggle js-menu-toggle" aria-label="Menu" aria-expanded="false"><span class="menu-toggle-box"><span class="menu-toggle-inner">Menu</span></span></button></div></header><main class="main"><article class="post"><div class="main__left"><figure class="hero"><img src="https://ct-choochoo.github.io/ch-publii-pages/media/website/_DSC4090-2.jpeg" srcset="https://ct-choochoo.github.io/ch-publii-pages/media/website/responsive/_DSC4090-2-xs.webp 300w, https://ct-choochoo.github.io/ch-publii-pages/media/website/responsive/_DSC4090-2-sm.webp 480w, https://ct-choochoo.github.io/ch-publii-pages/media/website/responsive/_DSC4090-2-md.webp 768w, https://ct-choochoo.github.io/ch-publii-pages/media/website/responsive/_DSC4090-2-lg.webp 1024w, https://ct-choochoo.github.io/ch-publii-pages/media/website/responsive/_DSC4090-2-xl.webp 1280w, https://ct-choochoo.github.io/ch-publii-pages/media/website/responsive/_DSC4090-2-2xl.webp 1600w" sizes="(min-width: 1800px) 50vw, (min-width: 900px) 40vw, 100vw" loading="eager" width="3194" height="4791" alt=""><figcaption class="hero__caption">生活美满,随时躺平</figcaption></figure><header><h1>RabbitMQ_简介</h1><p><time datetime="2023-03-11T18:08">三月 11, 2023 </time>by <a href="https://ct-choochoo.github.io/ch-publii-pages/authors/tiezhu/" rel="author" title="铁柱">铁柱</a></p></header></div><div class="main__right"><div class="post__entry"><h2 id="1-rabbitmq简介">1. RabbitMQ简介</h2><h3 id="11-什么是mq（message-queue）">1.1 什么是MQ（message queue）</h3><p>从字面意思上看，本质是个队列，<strong>FIFO</strong> 先入先出，只不过队列中存放的内容是 message 而已，还是一种跨进程的通信机制，用于上下游传递消息。在互联网架构中，MQ 是一种非常常 见的上下游“逻辑解耦+物理解耦”的消息通信服务。使用了 MQ 之后，消息发送上游只需要依赖 MQ，不 用依赖其他服务。</p><h3 id="12-mq的优劣势">1.2 MQ的优劣势</h3><ol><li><strong>优势</strong><ol><li><strong>解耦</strong>：提升系统容错性</li></ol></li></ol><pre><code>举个例子，如果订单系统最多能处理一万次订单，这个处理能力应付正常时段的下单时绰绰有余，正
常时段我们下单一秒后就能返回结果。但是在高峰期，如果有两万次下单操作系统是处理不了的，只能限
制订单超过一万后不允许用户下单。使用消息队列做缓冲，我们可以取消这个限制，把一秒内下的订单分
散成一段时间来处理，这时有些用户可能在下单十几秒后才能收到下单成功的操作，但是比不能下单的体
验要好。
</code></pre><ol start="2"><li><strong>异步提速</strong>：提升用户体验和吞吐量</li></ol><pre><code>    有些服务间调用是异步的，例如 A 调用 B，B 需要花费很长时间执行，但是 A 需要知道 B 什么时候可
以执行完，以前一般有两种方式，A 过一段时间去调用 B 的查询 api 查询。或者 A 提供一个 callback api， B 执行完之后调用 api 通知 A 服务。这两种方式都不是很优雅，使用消息总线，可以很方便解决这个问题，
A 调用 B 服务后，只需要监听 B 处理完成的消息，当 B 处理完成后，会发送一条消息给 MQ，MQ 会将此消
息转发给 A 服务。这样 A 服务既不用循环调用 B 的查询 api，也不用提供 callback api。同样B 服务也不用
做这些操作。A 服务还能及时的得到异步处理成功的消息。
</code></pre><ol start="3"><li>**削峰添谷：**提高系统稳定性</li></ol><pre><code>    以电商应用为例，应用中有订单系统、库存系统、物流系统、支付系统。用户创建订单后，如果耦合
调用库存系统、物流系统、支付系统，任何一个子系统出了故障，都会造成下单操作异常。当转变成基于
消息队列的方式后，系统间调用的问题会减少很多，比如物流系统因为发生故障，需要几分钟来修复。在
这几分钟的时间里，物流系统要处理的内存被缓存在消息队列中，用户的下单操作可以正常完成。当物流
系统恢复后，继续处理订单信息即可，中单用户感受不到物流系统的故障，提升系统的可用性。
</code></pre><ol start="2"><li>劣势<ol><li><strong>提高系统复杂性</strong></li><li><strong>系统可用性降低</strong></li></ol></li></ol><h3 id="13-常用消息队列对比">1.3 常用消息队列对比</h3><p></p><figure class="post__image"><img decoding="async" loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/118351/1647259494267-636a38ab-3c20-4f53-9017-1c1aeda1f6d7.png#clientId=u90f6d71e-5d0c-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=492&id=Uzo7y&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1082&originWidth=2414&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1710398&status=done&style=shadow&taskId=u5b34ebe0-ae78-48d0-ac01-1e23cb1f2f0&title=&width=1097.272703489982" alt="image.png" data-is-external-image="true"></figure><p></p><h2 id="2amqp-协议介绍">2.AMQP 协议介绍</h2><p>AMQP协议作为RabbitMQ的规范，规定了RabbitMQ对外接口，学会了AMQP协议的使用，就基本掌握了RabbitMQ的使用，学会了AMQP协议的概念，就基本掌握了RabbitMQ的核心概念</p><h3 id="21-amqp协议的作用">2.1 AMQP协议的作用</h3><ul><li>AMQP 是一个协议，规定了软件之间的行为</li><li>RabbitMQ 是AMQP协议的具体实现</li><li>AMQP协议还有其他实现，如RocketMQ等</li></ul><h3 id="22-amqp协议中的概念">2.2 AMQP协议中的概念</h3><p></p><figure class="post__image"><img decoding="async" loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/118351/1647432599876-ee71bac7-3593-4382-8c7b-ad22261142fd.png#clientId=u494735b0-f89b-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=455&id=KdLWn&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1002&originWidth=3660&originalType=binary&ratio=1&rotation=0&showTitle=false&size=713325&status=done&style=none&taskId=u92bf74b8-0ab8-4682-a2f3-6c5a53ac5a9&title=&width=1663.6363275780172" alt="image.png" data-is-external-image="true"></figure><p></p><ul><li>Broker: 接收和分发消息的应用，RabbitMQ 就是Message Broker</li><li>Virtual Host: 虚拟Broker，将多个单元隔离开</li><li>Connection: publisher／consumer和broker之间的TCP连接</li><li>Channel: connection内部建立的逻辑连接，通常每个线程创建单独的channel</li><li>Routing Key: 路由键，用来指示消息的路由转发，相当于快递的地址</li><li>Exchange: 交换机，相当于快递的分拨中心，是AMQP中的核心概念</li><li>Queue: 消息队列，消息最终被送到这里等待consumer取走</li><li>Binding: exchange和queue之间的虚拟连接，用于message的分发依据</li></ul><h3 id="23-amqp协议的核心概念-exchange">2.3 AMQP协议的核心概念-Exchange</h3><ul><li>在AMQP协议或者是RabbitMQ实现中，最核心的组件是Exchange</li><li>Exchange承担RabbitMQ的核心功能——路由转发</li><li>Exchange有多个种类，配置多变</li></ul><h2 id="3exchange介绍">3.Exchange介绍</h2><h3 id="31-exchange的作用">3.1 Exchange的作用</h3><ul><li>Exchange是AMQP协议和RabbitMQ的核心组件</li><li>Exchange的功能是根据绑定关系和路由键为消息提供路由，将消息转发至相应的队列</li><li>Exchange有4种类型：Direct / Topic / Fanout / Headers，其中Headers使用很少，以前三种为主</li></ul><h3 id="32-direct-exchange">3.2 Direct Exchange</h3><blockquote><p>Message中的Routing Key如果和Binding Key一致， Direct Exchange则将message发到对应的 queue中</p></blockquote><p></p><figure class="post__image"><img decoding="async" loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/118351/1647436001532-a8f9ec0c-e8d7-4e44-9c26-c0c3b7a07e60.png#clientId=u494735b0-f89b-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=477&id=qMr3j&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1906&originWidth=2766&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1254929&status=done&style=none&taskId=u21c5641f-5283-42e2-a508-d03d214c981&title=&width=692" alt="image.png" data-is-external-image="true"></figure><p></p><h3 id="33-fanout-exchange">3.3 Fanout Exchange</h3><blockquote><p>每个发到Fanout Exchange的message都会分发到所有绑定的queue上去</p></blockquote><p></p><figure class="post__image"><img decoding="async" loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/118351/1647435967634-56804d5b-e05a-4309-bdc7-89c3782abcb5.png#clientId=u494735b0-f89b-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=470&id=ZfobW&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1878&originWidth=2890&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1037912&status=done&style=none&taskId=u4e16b61c-7ef7-4493-8ef6-2c19fe05b45&title=&width=723" alt="image.png" data-is-external-image="true"></figure><p></p><h3 id="33-topic-exchange">3.3 Topic Exchange</h3><ul><li>根据Routing Key及通配规则，Topic Exchange将消息分发到目标Queue中全匹配：与Direct类似</li><li>Binding Key中的#:匹配任意个数的word</li><li>Binding Key中的*:匹配任意1个word</li></ul><p></p><figure class="post__image"><img decoding="async" loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/118351/1647436429655-a2e0210c-076f-4af7-927c-513a2f1b715b.png#clientId=u494735b0-f89b-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=475&id=YzUvO&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1900&originWidth=3384&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1292261&status=done&style=none&taskId=u6d7bf9b0-e83a-46ec-8bef-c81479e6329&title=&width=846" alt="image.png" data-is-external-image="true"></figure><p></p><h3></h3><p>4.RabbitMQ安装 （[[docker]]）</p><pre><code class="language-bash">docker run 
-p 1883:1883 \
-p 4369:4369 \
-p 5671:5671 \
-p 5672:5672 \
-p 8883:8883 \
-p 15672:15672 
-p 25672:25672 \
-p 15675:15675 \
-d \
--hostname my-rabbitmq \
--name rabbitmq1 \
-e RABBITMQ_DEFAULT_USER=admin \
-e RABBITMQ_DEFAULT_PASS=admin \
rabbitmq:3.8.3


#进入容器
docker exec -it name /bin/bash

#启用管理控制台插件
rabbitmq-plugins enable rabbitmq_management  管理控制台的默认端口是15672

#启用mqtt插件
rabbitmq-plugins enable rabbitmq_mqtt        默认端口mqtt是1883 mqtt://118.24.2.2:1883

#启用mqtt插件的websocket端口
rabbitmq-plugins enable rabbitmq_web_mqtt    默认端口websocket是15675 ws://118.24.2.2:15675/ws path是/ws
</code></pre><h2 id="4-管理后台页面">4. 管理后台页面</h2><p></p><figure class="post__image"><img decoding="async" loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/118351/1647482136496-6d1894af-a5f5-435d-b662-ba757c0ce7b8.png#clientId=u494735b0-f89b-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=726&id=uab293704&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1598&originWidth=3436&originalType=binary&ratio=1&rotation=0&showTitle=true&size=347931&status=done&style=none&taskId=ua40b540a-3f30-48d5-9ec9-4f51bfa0187&title=rabbit%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2&width=1561.818147966685" alt="image.png" data-is-external-image="true"></figure><p></p><h3 id="41-管控台的功能页面">4.1 管控台的功能页面</h3><ul><li>概览(overview)：查看节点/集群状态</li><li>连接(connections)：查看connection</li><li>通道(channel)：查看channel</li><li>交换机(Exchanges)：查看、操作交换机状态</li><li>队列(Queue)：查看、操作队列状态</li><li>管理(Admin)：高级管理功能</li></ul><h2 id="5常用命令">5.常用命令</h2><h3 id="51-状态查看">5.1 状态查看</h3><p>查看状态：rabbitmqctl status 查看绑定：rabbitmqctl list_bindings 查看channel：rabbitmqctl list_channels 查看connection：rabbitmqctl list_connections 查看消费者：rabbitmqctl list_consumers 查看交换机：rabbitmqctl list_exchanges 查看队列：rabbitmqctl list_queues 删除队列：rabbitmqctl delete_queue 清空队列：rabbitmqctl purge_queue</p><h3 id="52-用户相关">5.2 用户相关</h3><p>新建用户：rabbitmqctl add_user 修改用户密码：rabbitmqctl change_password 删除用户：rabbitmqctl delete_user 查看用户：rabbitmqctl list_users 设置用户角色：rabbitmqctl rabbitmqctl set_user_tags</p><h3 id="53-应用启停">5.3 应用启停</h3><p>启动应用：rabbitmqctl start_app 关闭应用：rabbitmqctl stop_app，保留Erlang虚拟机（暂停） 关闭应用：rabbitmqctl stop，并关闭Erlang虚拟机</p><h3 id="54-集群相关">5.4 集群相关</h3><p>加入集群：rabbitmqctl join_cluster 离开集群：rabbitmqctl reset</p><h3 id="55镜像队列">5.5镜像队列</h3><p>设置镜像队列：rabbitmqctl sync_queue 取消镜像队列：rabbitmqctl cancel_sync_queue</p><p>附： <a href="http://tryrabbitmq.com/">http://tryrabbitmq.com/</a> 消息发送模型模拟网站</p><footer><div class="post__tag-share"><div class="post__share"></div></div><div class="post__bio"><h3><a href="https://ct-choochoo.github.io/ch-publii-pages/authors/tiezhu/" title="铁柱">铁柱</a></h3></div></footer></div></div></article><div class="main__right"><div class="评论"><div class="comments-wrapper"><h5>评论区</h5><div id="cusdis_thread" data-host="https://cusdis.com" data-app-id="a6b326ad-a95f-4d7f-9076-1b06f4819430" data-page-id="6" data-page-url="https://ct-choochoo.github.io/ch-publii-pages/rabbitmq-yichu-bu-ren-shi/" data-page-title="RabbitMQ_简介" data-theme="light"></div><noscript>Please enable JS to use the comments form.</noscript><script type="text/javascript">var cusdis_element_to_check = document.getElementById('cusdis_thread');

				if ('IntersectionObserver' in window) {
					var iObserver = new IntersectionObserver(
						(entries, observer) => {
							entries.forEach(entry => {
								if (entry.intersectionRatio >= 0.1) {
									(function () {
										var d = document, s = d.createElement('script');
										s.defer = true;
										s.src = 'https://cusdis.com/js/cusdis.es.js';									
										(d.head || d.body).appendChild(s);
									})();
									observer.unobserve(entry.target);
								}
							});
						},
						{
							threshold: [0, 0.2, 0.5, 1]
						}
					);

					iObserver.observe(cusdis_element_to_check);
				} else {
					(function () {
						var d = document, s = d.createElement('script');
						s.defer = true;
						s.src = 'https://cusdis.com/js/cusdis.es.js';
						(d.head || d.body).appendChild(s);
					})();
				}</script><script type="text/javascript"></script></div></div><div class="banner banner--after-post"><script async defer="defer" src="https://cusdis.com/js/widget/lang/zh-cn.js"></script><script defer="defer" data-host="https://cusdis.com" data-app-id="{{id}}" src="https://cusdis.com/js/cusdis-count.umd.js"></script><div id="cusdis_thread" data-host="https://cusdis.com" data-app-id="a6b326ad-a95f-4d7f-9076-1b06f4819430" data-page-id="{{id}}" data-page-url="{{url}} " data-page-title="{{title}}"></div></div></div></main><footer class="footer"><div class="footer__copyright"><div style="text-align: left;"><a href="https://beian.miit.gov.cn/">陕ICP备2022014196号-1</a></div></div></footer></div></div><script defer="defer" src="https://ct-choochoo.github.io/ch-publii-pages/assets/js/scripts.min.js?v=27706a8fe221267c1834098c796f44c1"></script><script>var images = document.querySelectorAll('img[loading]');
   
           for (var i = 0; i < images.length; i++) {
               if (images[i].complete) {
                   images[i].classList.add('is-loaded');
               } else {
                   images[i].addEventListener('load', function () {
                       this.classList.add('is-loaded');
                   }, false);
               }
           }</script><script defer="defer" data-host="https://cusdis.com" data-app-id="a6b326ad-a95f-4d7f-9076-1b06f4819430" src="https://cusdis.com/js/cusdis-count.umd.js"></script><script src="https://ct-choochoo.github.io/ch-publii-pages/media/plugins/docSearch/docsearch.min.js"></script><script type="text/javascript">docsearch({
   				container: '#docsearch',
   				appId: '1940K55EKT',
   				indexName: 'blog_aow',
   				apiKey: '965ece45fd8bcfe08b8ce02572e77ea7',
   				debug: false
   			});</script></body></html>